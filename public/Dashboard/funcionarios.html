<!DOCTYPE html>
<html lang="en" id="html_fonte">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthGuard - Funcionários</title>
    <link rel="shortcut icon" type="imagex/png" href="../assets/icon/healthguard_icone.png">
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/menu_bar.css">
    <link rel="stylesheet" href="../css/funcionarios.css">
    <!-- Link JavaScript -->
</head>

<body onload="validarSessao()">
    <section class="tela">
        <div class="tela-box-copiar oculto">
            <div class="box-copiar">
                <img src="../assets/imgs/Icone ok.png" alt="" class="icon-ok">
                <div class="texto-copiar">Permissão alterada com sucesso!</div>
            </div>
        </div>

        <div class="tela-box-info-exclusao oculto">
            <div class="box-info-exclusao">
                <img src="../assets/imgs/Icone ok.png" alt="" class="icon-ok">
                <div class="texto-copiar">Funcionário excluído com sucesso!</div>
            </div>
        </div>

        <!-- Começo modais -->
        <div class="tela-escurecida oculto">
            <div id="popupFundo" class="popup-fundo oculto">
                <div class="popup">
                    <div class="popup-header">
                        <h2>Alterar Permissão</h2>
                        <button class="fechar" onclick="fecharPop()"><img class="fechar"
                                src="../assets/imgs/iconeFechar.png"></button>
                    </div>
                    <div class="line"></div>
                    <label for="nome">Nome da pessoa:</label>
                    <input type="text" id="nome" placeholder="Ex: Arthur Felipe">
                    <div class="texto-erro oculto" id="texto_erro_nome">Preencha o campo</div>
                    <label for="email">Email da pessoa:</label>
                    <input type="email" id="email" placeholder="Ex: example@example.com">
                    <div class="texto-erro oculto" id="texto_erro_email">Preencha o campo</div>
                    <label for="permissao">Selecione a permissão<span style="color: red;">*</span>:</label>
                    <select class="select-cargo" id="permissao">
                        <option value="tecnico" selected>Técnico de TI</option>
                        <option value="gestor">Gestor de TI</option>
                    </select>

                    <!-- <label for="data">Selecione data expiração<span style="color: red">*</span>:</label>
                    <input type="date" id="data"> -->
                    <div class="texto-erro oculto" id="texto_erro_permissao">Preencha o campo</div>
                    <button class="btn-convidar"
                        onclick="confirmarAlteracaoPermissao(idUsuarioClicadoAcao)">Alterar</button>
                </div>
            </div>
            <div id="popupConfirmacaoAlterar" class="popup-fundo oculto">
                <div class="popup popupConteudoConfirmacao">
                    <!-- <div class="popup-header">
                        <h2>Alterar Cargo/Permissão</h2>
                    </div> -->
                    <h2>Alterar Permissão</h2>
                    <p>
                        Você tem certeza que deseja alterar a permissão desse funcionário?
                        <br><br>

                        <b class="nome-usuario-modal-confirmacao"></b>

                        <!-- <br>
                        <br> -->

                        <br> <span class="troca-de-permissao"></span>

                        <br><br>
                    </p>

                    <div class="modal-botoes">
                        <button id="btn-cancelar" class="modal-botao btn-cancelar"
                            onclick="cancelarAlteracao()">Cancelar</button>
                        <button id="btn-confirmar-exclusao" class="modal-botao btn-excluir"
                            onclick="atualizarPermissaoFuncionario(idUsuarioClicadoAcao)">Sim, Alterar</button>
                    </div>
                </div>
            </div>
            <div id="popupConfirmacaoExcluir" class="popup-fundo oculto">
                <div class="popup popupConteudoConfirmacao">
                    <!-- <div class="popup-header">
                        <h2>Alterar Cargo/Permissão</h2>
                    </div> -->
                    <h2>Excluir funcionário</h2>
                    <p>
                        <br>
                        <b class="nome-usuario-modal-exclusao"></b>
                        <br><br>
                        Você tem certeza que deseja excluir esse funcionário? Esta ação é irreversível.


                        <!-- <br>
                        <br> -->

                        <!-- <br> <span class="troca-de-permissao"></span> -->

                        <br><br>
                    </p>

                    <div class="modal-botoes">
                        <button id="btn-cancelar" class="modal-botao btn-cancelar"
                            onclick="cancelarExclusao()">Cancelar</button>
                        <button id="btn-confirmar-exclusao" class="modal-botao btn-excluir"
                            onclick="excluirFuncionario(idUsuarioClicadoAcao)">Sim, Excluir</button>
                    </div>
                </div>
            </div>
            <div id="popupConviteGerado" class="popup-fundo oculto">
                <div class="popup">
                    <div class="popup-header">
                        <h2>Convite enviado</h2>
                        <button class="fechar" onclick="fecharPop()"><img class="fechar"
                                src="../assets/imgs/iconeFecharFiltro.png"></button>
                    </div>
                    <div class="line"></div>
                    <div class="texto-modal">O convite gerado com sucesso, e foi encaminhado para: <a
                            href="mailto:arthur.amahals1000@gmail.com" style="text-decoration: none;"
                            id="email_convite">arthur.amahals1000@gmail.com</a></div>
                    <div class="texto-modal">Código de convite gerado:</div>
                    <div class="box-codigo">
                        <div class="texto-codigo" id="codigo_texto">AAAAAAYO</div>
                        <img src="../assets/imgs/Icone Copiar.png" alt="" class="icon-copy" onclick="copiartexto()">
                    </div>
                    <button class="btn-convidar" onclick="fecharPop()">Fechar</button>
                </div>
            </div>
        </div>
        <!-- Fim modais -->

        <!-- Começo do Menu -->
        <div class="menu-lateral">
            <div class="pai-icones-superiores">
                <div id="logo">
                    <img src="../assets/imgs/HealthGuard_icone_BRANCO_fundo_transparente.png" alt="HealthGuard"
                        class="icone-logo-pequena">
                </div>
                <br>
                <div class="icone-box" id="monitoramento_redirecionamento">
                    <img src="../assets/imgs/icone_monitoramento.png" alt="Foto" class="icone-menu-1">
                    <div class="texto-icone oculto">Monitoramento</div>
                </div>
                <hr class="separador">
                <div class="icone-box" id="gestao_redirecionamento">
                    <img src="../assets/imgs/icone_gestao_usuarios.png" alt="Foto" class="icone-menu-2">
                    <div class="texto-icone oculto">Gestão de funcionários</div>
                </div>
                <hr class="separador">
                <div class="icone-box" id="alertas_redirecionamento">
                    <img src="../assets/imgs/icone_alerta.png" alt="Foto" class="icone-menu-3">
                    <div class="texto-icone oculto">Histórico de Alertas</div>
                </div>
                <hr class="separador">
                <div class="icone-box" id="gestao_convites">
                    <img src="../assets/imgs/icone-convite2.png" alt="Foto" class="icone-menu-2">
                    <div class="texto-icone oculto">Convites</div>
                </div>
                <hr class="separador">
                <div class="icone-box" id="suporte_redirecionamento">
                    <img src="../assets/imgs/icone_suporte.png" alt="Foto" class="icone-menu-4">
                    <div class="texto-icone oculto">Suporte</div>
                </div>
            </div>
            <div class="pai-icones-inferiores">
                <hr class="separador-forte">
                <div class="icone-box-inferior" id="tela_perfil">
                    <img src="../assets/imgs/icone_perfil.png" alt="Foto" class="icone-menu-5">
                    <div class="texto-icone oculto" id="nome_usuario">Perfil</div>
                </div>
                <hr class="separador">
                <div class="icone-box-inferior" id="sair_conta_redirecionamento">
                    <img src="../assets/imgs/icone_log-out.png" alt="Foto" class="icone-menu-6">
                    <div class="texto-icone oculto">Sair da conta</div>
                </div>
            </div>
        </div>
        <!-- Fim do Menu -->
        <div class="filtros-box">
            <div class="texto-organizacao" id="div_nome_empresa">
                Nome empresa
            </div>
            <div class="texto-topico">
                Lista de Funcionários:
            </div>
            <div class="area-filtros">
                <!-- ÁREA DESTINADA AOS FILTROS -->
                <div class="texto-funcionalidade alinhamento-centralizar-vertical">
                    Filtros:
                </div>
                <!-- uuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu -->
                <div class="box-filtros">
                    <div class="componente-filtro" id="campo-cpf">
                        Buscar por Nome: <input type="text" placeholder="Ex: Roberto" id="campo_nome">
                    </div>

                    <div class="componente-filtro" id="campo-status-convite">
                        Cargo/Permissão:
                        <select name="viagem" id="campo_status_convite">
                            <option value="selecione">Selecione</option>
                            <option value="Gestor de TI">Gestor de TI</option>
                            <option value="Técnico de TI">Técnico de TI</option>
                        </select>

                        <button class="botao-aplicar-filtros" onclick="adicionarFiltro()">
                            Aplicar filtros
                        </button>
                    </div>

                    <!-- <div class="componente-filtro" id="campo-data-convite-gerado">
                        Convite gerado entre: <input type="date" id="campo_data_convite_gerado_min"> e: <input
                            type="date" id="campo_data_convite_gerado_max">
                    </div> -->
                </div>

                <div class="box-filtros-aplicados" id="div_filtros">
                    <!-- <div class="filtro-aplicado">
                        Cargo/Permissão: Técnico de TI &nbsp <img src="../assets/imgs/iconeFecharFiltro.png"
                            onclick="fecharFiltro(1)">
                    </div> -->
                    <!-- <div class="filtro-aplicado">
                        Gerado entre: 10/10/1025 - 15/10/2025 &nbsp <img src="../assets/imgs/iconeFecharFiltro.png">
                    </div>
                    <div class="filtro-aplicado">
                        Expirado entre: 25/10/1025 - 27/10/2025 &nbsp <img src="../assets/imgs/iconeFecharFiltro.png">
                    </div> -->
                </div>

            </div>
            <div class="box-selecao-funcionario">
                <div class="texto-funcionalidade alinhamento-centralizar-vertical">
                    Selecione um funcionário:
                </div>

                <div class="filtro-direita">
                    <button class="botao-codigo" onclick="window.location.href='acessos.html'"">
                        Ver ações do funcionário 
                    </button>

                    <!-- <div class=" div-botao-adicionar" id="botao_novo_convite">
                        <img src="../assets/imgs/Icone mais.png" alt="icone Mais" class="icone-mais">
                        <div class="barra-vertical-botao"></div>
                        <div class="texto-botao-adicionar">
                            Novo convite
                        </div>
                </div> -->
                <button class="botao-recarregar" onclick="puxarFuncionarios()" title="Atualizar tabela">
                    <img src="../assets/imgs/icone-recarregar.png" alt="" class="icone-recarregar">
                </button>
            </div>
        </div>
        <div id="container-tabela">
            <table id="tabela_funcionarios">
                <tr id="titulo-tabela">
                    <td id="tr-seletor"></td>
                    <td id="tr-nome-completo">Nome Completo</td>
                    <td id="tr-email">E-mail</td>
                    <td id="tr-cpf-funcionario">CPF</td>
                    <td id="tr-permissao">Cargo/Permissão</td>
                    <td id="tr-acoes-funcionario">Ações</td>
                </tr>
                <tr class="dados-tabela">
                    <td class="td-seletor"><input class="checkbox-padrao" type="checkbox"></td>
                    <td class="td-nome-completo">André Augusto Corado Leão</td>
                    <td class="td-email">andre@gmail.com</td>
                    <td class="td-cpf-funcionario">000.000.000-00</td>
                    <td class="td-permissao">Técnico de TI</td>
                    <td class="td-acoes-funcionario">
                        <div class="icone-editar">
                            <img src="../assets/imgs/user-edit.png" alt="Editar">
                        </div>
                        <div class="icone-excluir">
                            <img src="../assets/imgs/contact.png" alt="Excluir">
                        </div>
                    </td>
                </tr>
                <tr class="dados-tabela">
                    <td class="td-seletor"><input class="checkbox-padrao" type="checkbox"></td>
                    <td class="td-nome-completo">André Augusto Corado Leão</td>
                    <td class="td-email">andre@gmail.com</td>
                    <td class="td-cpf-funcionario">000.000.000-00</td>
                    <td class="td-permissao">Técnico de TI</td>
                    <td class="td-acoes-funcionario">
                        <div class="icone-editar">
                            <img src="../assets/imgs/user-edit.png" alt="Editar">
                        </div>
                        <div class="icone-excluir">
                            <img src="../assets/imgs/contact.png" alt="Excluir">
                        </div>
                    </td>
                </tr>
                <tr class="dados-tabela">
                    <td class="td-seletor"><input class="checkbox-padrao" type="checkbox"></td>
                    <td class="td-nome-completo">André Augusto Corado Leão</td>
                    <td class="td-email">andre@gmail.com</td>
                    <td class="td-cpf-funcionario">000.000.000-00</td>
                    <td class="td-permissao">Técnico de TI</td>
                    <td class="td-acoes-funcionario">
                        <div class="icone-editar">
                            <img src="../assets/imgs/user-edit.png" alt="Editar">
                        </div>
                        <div class="icone-excluir">
                            <img src="../assets/imgs/contact.png" alt="Excluir">
                        </div>
                    </td>
                </tr>
                <tr class="dados-tabela">
                    <td class="td-seletor"><input class="checkbox-padrao" type="checkbox"></td>
                    <td class="td-nome-completo">André Augusto Corado Leão</td>
                    <td class="td-email">andre@gmail.com</td>
                    <td class="td-cpf-funcionario">000.000.000-00</td>
                    <td class="td-permissao">Técnico de TI</td>
                    <td class="td-acoes-funcionario">
                        <div class="icone-editar">
                            <img src="../assets/imgs/user-edit.png" alt="Editar">
                        </div>
                        <div class="icone-excluir">
                            <img src="../assets/imgs/contact.png" alt="Excluir">
                        </div>
                    </td>
                </tr>
                <tr class="dados-tabela">
                    <td class="td-seletor"><input class="checkbox-padrao" type="checkbox"></td>
                    <td class="td-nome-completo">André Augusto Corado Leão</td>
                    <td class="td-email">andre@gmail.com</td>
                    <td class="td-cpf-funcionario">000.000.000-00</td>
                    <td class="td-permissao">Técnico de TI</td>
                    <td class="td-acoes-funcionario">
                        <div class="icone-editar">
                            <img src="../assets/imgs/user-edit.png" alt="Editar">
                        </div>
                        <div class="icone-excluir">
                            <img src="../assets/imgs/contact.png" alt="Excluir">
                        </div>
                    </td>
                </tr>
                <tr class="dados-tabela">
                    <td class="td-seletor"><input class="checkbox-padrao" type="checkbox"></td>
                    <td class="td-nome-completo">André Augusto Corado Leão</td>
                    <td class="td-email">andre@gmail.com</td>
                    <td class="td-cpf-funcionario">000.000.000-00</td>
                    <td class="td-permissao">Técnico de TI</td>
                    <td class="td-acoes-funcionario">
                        <div class="icone-editar">
                            <img src="../assets/imgs/user-edit.png" alt="Editar">
                        </div>
                        <div class="icone-excluir">
                            <img src="../assets/imgs/contact.png" alt="Excluir">
                        </div>
                    </td>
                </tr>
                <tr class="dados-tabela">
                    <td class="td-seletor"><input class="checkbox-padrao" type="checkbox"></td>
                    <td class="td-nome-completo">André Augusto Corado Leão</td>
                    <td class="td-email">andre@gmail.com</td>
                    <td class="td-cpf-funcionario">000.000.000-00</td>
                    <td class="td-permissao">Técnico de TI</td>
                    <td class="td-acoes-funcionario">
                        <div class="icone-editar">
                            <img src="../assets/imgs/user-edit.png" alt="Editar">
                        </div>
                        <div class="icone-excluir">
                            <img src="../assets/imgs/contact.png" alt="Excluir">
                        </div>
                    </td>
                </tr>
                <tr class="dados-tabela">
                    <td class="td-seletor"><input class="checkbox-padrao" type="checkbox"></td>
                    <td class="td-nome-completo">André Augusto Corado Leão</td>
                    <td class="td-email">andre@gmail.com</td>
                    <td class="td-cpf-funcionario">000.000.000-00</td>
                    <td class="td-permissao">Técnico de TI</td>
                    <td class="td-acoes-funcionario">
                        <div class="icone-editar">
                            <img src="../assets/imgs/user-edit.png" alt="Editar">
                        </div>
                        <div class="icone-excluir">
                            <img src="../assets/imgs/contact.png" alt="Excluir">
                        </div>
                    </td>
                </tr>

            </table>
        </div>
        </div>
    </section>
    <script src="../js/validarSessao.js"></script>
    <script src="../js/menu-lateral.js"></script>
    <script>

      
        div_nome_empresa.innerHTML = sessionStorage.NOME_UNIDADE
        var funcionarios; // Auxiliar que armazena os funcionários
        var index; // Armazena informações completas (indice) do usuario clicado
        var idUsuarioClicadoAcao; // Guarda o id do usuário clicado (editar ou remover) para exibir nome no modal
        var permissaoAtual; // Permissão que o usuário possui antes da alteração
        var novaPermissao; // Permissão que o usuário irá possuir com a alteração

        
        var filtrosAtivos = ["", ""]

      
        function registrarLogAcao(acao, status) {
            fetch("/logAcoes/registrar", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    fkUnidadeAtendimento: sessionStorage.fkUnidadeAtendimento,
                    fkLogAcesso: sessionStorage.fkLogAcesso,
                    fkUsuario: sessionStorage.idUsuario,
                    acao: acao,
                    statusAcao: status
                })
            });
        }

      
        function fecharFiltro(index) {
            if (index < 0 || index >= 2) return;
            filtrosAtivos[index] = "";
            adicionarFiltro();
        }

        function adicionarFiltro() {
            var input_buscar_nome = document.getElementById("campo_nome")
            var select_tipo_convite = document.getElementById("campo_status_convite")
            var replotagem_nome = true
            var replotagem_status = true
            div_filtros.innerHTML = ""

            if (input_buscar_nome.value.length != 0) {
                filtrosAtivos[0] = input_buscar_nome.value
                div_filtros.innerHTML += `
                <div class="filtro-aplicado">
                    Nome: ${input_buscar_nome.value} &nbsp <img src="../assets/imgs/iconeFecharFiltro.png" onclick="fecharFiltro(0)">
                </div>`
                input_buscar_nome.value = ""
                replotagem_nome = false
            }
            if (select_tipo_convite.value != "selecione") {
                filtrosAtivos[1] = select_tipo_convite.value
                div_filtros.innerHTML += `
                <div class="filtro-aplicado">
                    Cargo/Permissão: ${select_tipo_convite.value} &nbsp <img src="../assets/imgs/iconeFecharFiltro.png" onclick="fecharFiltro(1)">
                </div>`
                select_tipo_convite.value = "selecione"
                replotagem_status = false
            }
            if (filtrosAtivos[0].length != 0 && replotagem_nome) {
                div_filtros.innerHTML += `
                <div class="filtro-aplicado">
                    Nome: ${filtrosAtivos[0]} &nbsp <img src="../assets/imgs/iconeFecharFiltro.png" onclick="fecharFiltro(0)">
                </div>`
            }
            if (filtrosAtivos[1].length != 0 && replotagem_status) {
                div_filtros.innerHTML += `
                <div class="filtro-aplicado">
                    Cargo/Permissão: ${filtrosAtivos[1]} &nbsp <img src="../assets/imgs/iconeFecharFiltro.png" onclick="fecharFiltro(1)">
                </div>`
            }
            puxarFuncionarios()
        }

        function filtrarFuncionarios(dados) {
            var dados_filtrados = []
            var vetor_auxiliar_nome = []

            if (filtrosAtivos[0] == '') {
                vetor_auxiliar_nome = dados
            } else {
                for (let i = 0; i < dados.length; i++) {
                    if (formatarTextoParaComparacao(dados[i].nomeUsuario).includes(formatarTextoParaComparacao(filtrosAtivos[0]))) {
                        vetor_auxiliar_nome.push(dados[i])
                    }
                }
            }

            if (filtrosAtivos[1] == "") {
                dados_filtrados = vetor_auxiliar_nome
            } else {
                for (let i = 0; i < vetor_auxiliar_nome.length; i++) {
                    if ((filtrosAtivos[1] == vetor_auxiliar_nome[i].permissao)) {
                        dados_filtrados.push(vetor_auxiliar_nome[i])
                    }
                }
            }
            return dados_filtrados
        }

        function puxarFuncionarios() {
            var variaveis = puxarVariaveis()
            variaveis = variaveis.idUnidadeAtendimento
            tabela_funcionarios.innerHTML = `
            <tr id="titulo-tabela">
                <td id="tr-seletor"></td>
                <td id="tr-nome-completo">Nome Completo</td>
                <td id="tr-email">E-mail</td>
                <td id="tr-cpf-funcionario">CPF</td>
                <td id="tr-permissao">Permissão</td>
                <td id="tr-acoes-funcionario">Ações</td>
            </tr>`

            fetch(`/funcionarios/buscarfuncionarios/${variaveis}`)
                .then(resposta => resposta.json())
                .then(resposta => {
                    registrarLogAcao("Listar funcionários", "sucesso")
                    var dados_filtrados = filtrarFuncionarios(resposta)
                    atualizarTabela(dados_filtrados)
                    funcionarios = dados_filtrados
                })
                .catch(erro => {
                    registrarLogAcao("Listar funcionários", "falha")
                    console.log("Erro no catch:", erro)
                })
        }

        function atualizarTabela(dados) {
            let variaveis = puxarVariaveis()
            for (let i = 0; i < dados.length; i++) {
                if (dados[i].idUsuario == variaveis.idUsuario) {
                    tabela_funcionarios.innerHTML += `
                    <tr class="dados-tabela">
                        <td class="td-seletor"><input class="checkbox-padrao" type="checkbox"></td>
                        <td class="td-nome-completo">${dados[i].nomeUsuario}</td>
                        <td class="td-email">${dados[i].email}</td>
                        <td class="td-cpf-funcionario">${mascaraCPF(dados[i].cpf)}</td>
                        <td class="td-permissao">${dados[i].permissao}</td>
                        <td class="td-acoes-funcionario"><b style="color: #656464;">(Você)</b></td>
                    </tr>`
                } else {
                    tabela_funcionarios.innerHTML += `
                    <tr class="dados-tabela">
                        <td class="td-seletor"><input class="checkbox-padrao" type="checkbox"></td>
                        <td class="td-nome-completo">${dados[i].nomeUsuario}</td>
                        <td class="td-email">${dados[i].email}</td>
                        <td class="td-cpf-funcionario">${mascaraCPF(dados[i].cpf)}</td>
                        <td class="td-permissao">${dados[i].permissao}</td>
                        <td class="td-acoes-funcionario">
                            <div class="icone-editar" onclick="editarPermissaoFuncionario(${dados[i].idUsuario})" title="Alterar permissão">
                                <img src="../assets/imgs/user-edit.png" alt="Editar">
                            </div>
                            <div class="icone-excluir" onclick="confirmarExclusaoFuncionario(${dados[i].idUsuario})" title="Excluir funcionário">
                                <img src="../assets/imgs/contact.png" alt="Excluir">
                            </div>
                        </td>
                    </tr>`
                }
            }
        }

        function formatarTextoParaComparacao(texto) {
            var texto_formatado = "" + texto
            texto_formatado = texto_formatado.toLowerCase()
            texto_formatado = texto_formatado.replaceAll(" ", "")
            return texto_formatado
        }

        function mascaraCPF(cpf) {
            let value = cpf.replace(/\D/g, '')
            if (value.length > 11) value = value.substring(0, 11)
            value = value.replace(/(\d{3})(\d)/, '$1.$2')
                .replace(/(\d{3})(\d)/, '$1.$2')
                .replace(/(\d{3})(\d{1,2})$/, '$1-$2')
            return value
        }

        function copiartexto() {
            var codigo = document.getElementById("codigo_texto").innerText
            navigator.clipboard.writeText(codigo)
            document.querySelector(".tela-box-copiar").classList.remove("oculto")
            setTimeout(() => document.querySelector(".tela-box-copiar").classList.add("oculto"), 3000)
        }

        function infoExclusao() {
            var codigo = document.getElementById("codigo_texto").innerText
            navigator.clipboard.writeText(codigo)
            document.querySelector(".tela-box-info-exclusao").classList.remove("oculto")
            setTimeout(() => document.querySelector(".tela-box-info-exclusao").classList.add("oculto"), 3000)
        }

        
        function editarPermissaoFuncionario(idUsuario) {
            index = funcionarios.findIndex(func => func.idUsuario === idUsuario)
            document.querySelector('.tela-escurecida').classList.remove('oculto')
            document.getElementById("popupFundo").classList.remove("oculto")
            document.getElementById('html_fonte').style.overflowY = "hidden"

            nome.value = funcionarios[index].nomeUsuario
            nome.disabled = true
            email.value = funcionarios[index].email
            email.disabled = true

            if (funcionarios[index].permissao == "Técnico de TI") {
                document.getElementById("permissao").value = "tecnico"
                permissaoAtual = "Técnico de TI"
            } else if (funcionarios[index].permissao == "Gestor de TI") {
                document.getElementById("permissao").value = "gestor"
                permissaoAtual = "Gestor de TI"
            }

            idUsuarioClicadoAcao = idUsuario
            registrarLogAcao("Abrir edição de permissão", "sucesso")
        }

        function confirmarAlteracaoPermissao(idUsuarioClicado) {
            if ((permissaoAtual == "Técnico de TI" && document.getElementById("permissao").value == "tecnico") ||
                (permissaoAtual == "Gestor de TI" && document.getElementById("permissao").value == "gestor")) {
                texto_erro_permissao.classList.remove("oculto")
                texto_erro_permissao.innerHTML = `Esse funcionário já possui essa permissão`
                registrarLogAcao("Tentar alterar permissão", "falha")
            } else {
                if (document.getElementById("permissao").value == "tecnico") {
                    novaPermissao = "Técnico de TI"
                    fkPermissao = 2
                } else {
                    novaPermissao = "Gestor de TI"
                    fkPermissao = 1
                }
                fecharPop()
                document.querySelector('.tela-escurecida').classList.remove('oculto')
                document.getElementById("popupConfirmacaoAlterar").classList.remove("oculto")
                document.getElementById('html_fonte').style.overflowY = "hidden"
                document.querySelector('.nome-usuario-modal-confirmacao').innerHTML = funcionarios[index].nomeUsuario
                document.querySelector('.troca-de-permissao').innerHTML = `${permissaoAtual} --> ${novaPermissao}`
            }
        }

        function fecharPop() {
            texto_erro_permissao.classList.add("oculto")
            document.querySelector('.tela-escurecida').classList.add('oculto')
            document.getElementById("popupFundo").classList.add("oculto")
            document.getElementById("popupConviteGerado").classList.add("oculto")
            document.getElementById('html_fonte').style.overflowY = "auto"
        }

        function cancelarAlteracao() {
            document.querySelector('.tela-escurecida').classList.add('oculto')
            document.getElementById("popupConfirmacaoAlterar").classList.add("oculto")
            document.getElementById("popupConviteGerado").classList.add("oculto")
            document.getElementById('html_fonte').style.overflowY = "auto"
        }

        function atualizarPermissaoFuncionario(idUsuario) {
            document.querySelector('.tela-escurecida').classList.add('oculto')
            document.getElementById("popupConfirmacaoAlterar").classList.add("oculto")
            document.getElementById("popupConviteGerado").classList.add("oculto")
            document.getElementById('html_fonte').style.overflowY = "auto"

            fetch(`/funcionarios/atualizarpermissao/${idUsuario}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ fkPermissao })
            })
                .then(r => r.json())
                .then(r => {
                    registrarLogAcao("Alterar permissão", "sucesso")
                    console.log("Permissão atualizada!")
                    copiartexto()
                })
                .catch(err => {
                    registrarLogAcao("Alterar permissão", "falha")
                    console.log("Erro:", err)
                })
        }

        function confirmarExclusaoFuncionario(idUsuario) {
            index = funcionarios.findIndex(func => func.idUsuario === idUsuario)
            document.querySelector('.tela-escurecida').classList.remove('oculto')
            document.getElementById("popupConfirmacaoExcluir").classList.remove("oculto")
            document.getElementById('html_fonte').style.overflowY = "hidden"
            document.querySelector('.nome-usuario-modal-exclusao').innerHTML = funcionarios[index].nomeUsuario
            idUsuarioClicadoAcao = idUsuario
            registrarLogAcao("Abrir exclusão de funcionário", "sucesso")
        }

        function cancelarExclusao() {
            document.querySelector('.tela-escurecida').classList.add('oculto')
            document.getElementById("popupConfirmacaoExcluir").classList.add("oculto")
            document.getElementById("popupConviteGerado").classList.add("oculto")
            document.getElementById('html_fonte').style.overflowY = "auto"
        }

        function excluirFuncionario(idUsuario) {
            document.querySelector('.tela-escurecida').classList.add('oculto')
            document.getElementById("popupConfirmacaoExcluir").classList.add("oculto")
            document.getElementById('html_fonte').style.overflowY = "auto"

            fetch(`/funcionarios/excluirfuncionario/${idUsuario}`, { method: "PUT" })
                .then(r => r.json())
                .then(r => {
                    registrarLogAcao("Excluir funcionário", "sucesso")
                    console.log("Usuário excluído!")
                    infoExclusao()
                })
                .catch(err => {
                    registrarLogAcao("Excluir funcionário", "falha")
                    console.log("Erro:", err)
                })
        }
    </script>

</body>

</html>
