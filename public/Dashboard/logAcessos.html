<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Logs de Acesso</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="shortcut icon" type="imagex/png" href="../assets/icon/healthguard_icone.png">
    <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/menu_bar.css">
    <link rel="stylesheet" href="../css/logAcessos.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>

    <!-- Começo do Menu -->
    <div class="menu-lateral">
        <div class="pai-icones-superiores">
            <div id="logo">
                <img src="../assets/imgs/HealthGuard_icone_BRANCO_fundo_transparente.png" alt="HealthGuard"
                    class="icone-logo-pequena">
            </div>
            <br>
            <div class="icone-box" id="monitoramento_redirecionamento">
                <img src="../assets/imgs/icone_monitoramento.png" alt="Foto" class="icone-menu-1">
                <div class="texto-icone oculto">Monitoramento</div>
            </div>
            <hr class="separador">
            <div class="icone-box" id="gestao_redirecionamento">
                <img src="../assets/imgs/icone_gestao_usuarios.png" alt="Foto" class="icone-menu-2">
                <div class="texto-icone oculto">Gestão de usuários</div>
            </div>
            <hr class="separador">
            <div class="icone-box" id="alertas_redirecionamento">
                <img src="../assets/imgs/icone_alerta.png" alt="Foto" class="icone-menu-3">
                <div class="texto-icone oculto">Histórico de Alertas</div>
            </div>
            <hr class="separador">
            <div class="icone-box" id="suporte_redirecionamento">
                <img src="../assets/imgs/icone_suporte.png" alt="Foto" class="icone-menu-4">
                <div class="texto-icone oculto">Suporte</div>
            </div>
        </div>
        <div class="pai-icones-inferiores">
            <hr class="separador-forte">
            <div class="icone-box-inferior">
                <img src="../assets/imgs/icone_perfil.png" alt="Foto" class="icone-menu-5">
                <div class="texto-icone oculto" id="nome_usuario">Perfil</div>
            </div>
            <hr class="separador">
            <div class="icone-box-inferior" id="sair_conta_redirecionamento">
                <img src="../assets/imgs/icone_log-out.png" alt="Foto" class="icone-menu-6">
                <div class="texto-icone oculto">Sair da conta</div>
            </div>
        </div>
    </div>
    <!-- Fim do Menu -->
    <div class="container-principal">

        <nav class="espaco-menu" aria-label="Espaço para menu lateral">

        </nav>


        <main class="area-conteudo" role="main" aria-labelledby="tituloLogs">
            <h1 class="titulo-pagina" id="tituloLogs">Logs de Acesso</h1>
            <p class="descricao-pagina">
                Monitora acessos, falhas e atividades do sistema.
            </p>


            <section class="area-kpis-superiores" aria-label="Indicadores principais">
                <div class="kpi" tabindex="0" aria-describedby="descricaoTotalEventos">
                    <span class="descricao-kpi" id="descricaoTotalEventos">Total de Eventos</span>
                    <span class="icone-info">i</span>
                    <span class="valor-kpi">23</span>
                </div>

                <div class="kpi" tabindex="0" aria-describedby="descricaoUsuariosAtivos">
                    <span class="descricao-kpi" id="descricaoUsuariosAtivos">Usuários Ativos</span>
                    <span class="icone-info">i</span>
                    <span class="valor-kpi">15</span>
                </div>

                <div class="kpi" tabindex="0" aria-describedby="descricaoMaquinasAlteradas">
                    <span class="descricao-kpi" id="descricaoMaquinasAlteradas">Máquinas Alteradas</span>
                    <span class="icone-info">i</span>
                    <span class="valor-kpi">6</span>
                </div>

                <div class="kpi" tabindex="0" aria-describedby="descricaoFalhasEmAcoes">
                    <span class="descricao-kpi" id="descricaoFalhasEmAcoes">Falhas Em Ações</span>
                    <span class="icone-info">i</span>
                    <span class="valor-kpi">4</span>
                </div>
            </section>


            <section class="area-filtros" aria-label="Filtros para os dados">
                <span class="texto-filtrar-por">Últimas 24h de atividades.</span>

                </select>


            </section>


            <section class="area-graficos" aria-label="Gráficos do sistema">
                <article class="cartao-grafico" aria-labelledby="tituloCargaTrabalho">
                    <header class="titulo-grafico">
                        <span id="tituloCargaTrabalho">Carga de Trabalho do Sistema</span>
                        <span class="icone-info">i</span>
                    </header>

                    <canvas id="graficoCargaTrabalho" aria-label="Gráfico linha da carga de trabalho"
                        role="img"></canvas>
                </article>

                <article class="cartao-grafico" aria-labelledby="tituloTiposAcao">
                    <span class="icone-info">i</span>
                    <header>
                        <span class="titulo-grafico" id="tituloTiposAcao">Tipos De Ação</span>

                    </header>
                    <p class="subtitulo-grafico">(Leitura, Escrita/Alteração, Segurança)</p>

                    <canvas id="graficoTiposAcao" aria-label="Histograma de tipos de ação" role="img"></canvas>
                </article>

                <article class="cartao-grafico" aria-labelledby="tituloUsuariosAtivosSite">
                    <header class="titulo-grafico">
                        <span id="tituloUsuariosAtivosSite">Usuários Mais Ativos No Site</span>
                        <span class="icone-info">i</span>
                    </header>
                    <canvas id="graficoUsuariosAtivos" aria-label="Gráfico barras usuários ativos" role="img"></canvas>
                </article>
            </section>


            <section class="linha-insights" style="display:flex; gap:20px;">

                <div class="cartao-insight" style="flex:1;">
                    <h3>Insights</h3>
                    <p class="texto-insight"> ... </p>
                </div>

                <div class="cartao-insight" style="flex:1;">
                    <h3>Sugestões</h3>
                    <p class="texto-sugestoes"> ... </p>
                </div>

                <div class="cartao-downloads" aria-label="Downloads de dados" style="flex:1;">
                    <p tabindex="0">Baixar relatório de dados.</p>
                    <p tabindex="0">Baixar Excel de dados.</p>
                </div>

            </section>






        </main>
    </div>


    <script src="../js/menu-lateral.js"></script>
    <script>

        const ctxCarga = document.getElementById('graficoCargaTrabalho').getContext('2d');
        new Chart(ctxCarga, {
            type: 'line',
            data: {
                labels: ['22:00', '23:00', '00:00', '01:00', '02:00', '03:00'],
                datasets: [{
                    label: 'Carga de Trabalho',
                    data: [4, 8, 12, 16, 18, 20],
                    borderColor: '#b70000',
                    backgroundColor: 'rgba(183,0,0,0.2)',
                    fill: true,
                    tension: 0.4,
                    pointRadius: 5,
                    pointBackgroundColor: '#b70000',
                    pointHoverRadius: 7
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true, max: 25, ticks: { stepSize: 5 } } }
            }
        });

        const ctxTiposAcao = document.getElementById('graficoTiposAcao').getContext('2d');
        new Chart(ctxTiposAcao, {
            type: 'bar',
            data: {
                labels: ['2', '4', '6', '8', '10', '12', '14'],
                datasets: [{
                    label: 'Número de Ações',
                    data: [2, 5, 6, 6, 4, 3, 2],
                    backgroundColor: 'skyblue'
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true, max: 7, ticks: { stepSize: 1 } } }
            }
        });

        const ctxUsuarios = document.getElementById('graficoUsuariosAtivos').getContext('2d');
        new Chart(ctxUsuarios, {
            type: 'bar',
            data: {
                labels: ['Marcos', 'Giovanna', 'Henrique', 'Lucas', 'Alfredo', 'Cecília'],
                datasets: [{
                    label: 'Usuários Ativos',
                    data: [3, 7, 12, 15, 16, 18],
                    backgroundColor: [
                        '#7ed6df', '#1e90ff', '#00008b', '#008000', '#0000cd', '#32cd32'
                    ]
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true, max: 20, ticks: { stepSize: 5 } } }
            }
        });

        function gerarSugestoes(dados) {
            const mensagens = [];
            const sugestoes = [];

            if (dados.falhas > 5) {
                mensagens.push("Alto número de falhas detectado hoje.");
                sugestoes.push("Verificar logs detalhados e reiniciar serviços.");
            } else if (dados.falhas > 2) {
                mensagens.push("Volume moderado de falhas registrado.");
                sugestoes.push("Observar comportamento e monitorar eventos.");
            }

            if (dados.totalEventos > 30) {
                mensagens.push("Grande volume de eventos registrado.");
                sugestoes.push("Considerar otimizar consultas.");
            } else if (dados.totalEventos < 10) {
                mensagens.push("Poucos eventos registrados.");
                sugestoes.push("Confirmar se o sistema está operando normalmente.");
            }

            if (dados.usuariosAtivos > 20) {
                mensagens.push("Número alto de usuários ativos simultaneamente.");
                sugestoes.push("Monitorar performance e conexões simultâneas.");
            } else if (dados.usuariosAtivos < 5) {
                mensagens.push("Poucos usuários conectados.");
                sugestoes.push("Verificar disponibilidade do sistema.");
            }

            if (dados.maquinasAlteradas > 5) {
                mensagens.push("Diversas máquinas sofreram alterações recentemente.");
                sugestoes.push("Revisar mudanças recentes.");
            }

            if (mensagens.length === 0) {
                mensagens.push("Atividade dentro dos padrões esperados até o momento.");
                sugestoes.push("Continuar monitoramento padrão.");
            }

            return { mensagens, sugestoes };
        }

        function atualizarInsightESugestoes() {
            const dados = coletarDadosDasKpis();
            const resultado = gerarSugestoes(dados);

            document.querySelector(".cartao-insight .texto-insight").textContent = resultado.mensagens[Math.floor(Math.random() * resultado.mensagens.length)];

 
            const blocoSugestoes = document.querySelector(".cartao-insight + .cartao-insight .texto-sugestoes");
            blocoSugestoes.textContent = resultado.sugestoes.join(" ");

        }

        atualizarInsightESugestoes();



        function coletarDadosDasKpis() {
            return {
                totalEventos: Number(document.querySelectorAll(".kpi .valor-kpi")[0].textContent),
                usuariosAtivos: Number(document.querySelectorAll(".kpi .valor-kpi")[1].textContent),
                maquinasAlteradas: Number(document.querySelectorAll(".kpi .valor-kpi")[2].textContent),
                falhas: Number(document.querySelectorAll(".kpi .valor-kpi")[3].textContent)
            };
        }



        atualizarInsight();

        function exportarExcel() {

            var carga = [4, 8, 12, 16, 18, 20];
            var tiposAcao = [2, 5, 6, 6, 4, 3, 2];
            var usuarios = [3, 7, 12, 15, 16, 18];

            var csv = "Categoria,Valores\n";

            csv += "Carga de Trabalho," + carga.join(" | ") + "\n";
            csv += "Tipos de Ação," + tiposAcao.join(" | ") + "\n";
            csv += "Usuários Ativos," + usuarios.join(" | ") + "\n";


            var blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
            var url = URL.createObjectURL(blob);

            var a = document.createElement("a");
            a.href = url;
            a.download = "dados_logs.csv";
            a.click();
        }


        function gerarRelatorioDeAlertas() {

            var totalEventos = Number(document.querySelectorAll(".valor-kpi")[0].textContent);
            var usuariosAtivos = Number(document.querySelectorAll(".valor-kpi")[1].textContent);
            var maquinasAlteradas = Number(document.querySelectorAll(".valor-kpi")[2].textContent);
            var falhas = Number(document.querySelectorAll(".valor-kpi")[3].textContent);


            var alertas = [];

            if (falhas > 5) {
                alertas.push(" Alto número de falhas detectado hoje. Possível instabilidade do sistema.");
            } else if (falhas > 2) {
                alertas.push(" Volume moderado de falhas registrado. Observar comportamento.");
            }

            if (totalEventos > 30) {
                alertas.push(" Grande volume de eventos registrado. Uso intenso do sistema.");
            } else if (totalEventos < 10) {
                alertas.push(" Poucos eventos registrados. Atividade baixa.");
            }

            if (usuariosAtivos > 20) {
                alertas.push(" Número alto de usuários ativos simultaneamente.");
            } else if (usuariosAtivos < 5) {
                alertas.push(" Poucos usuários conectados no período atual.");
            }

            if (maquinasAlteradas > 5) {
                alertas.push(" Diversas máquinas sofreram alterações recentemente.");
            }

            if (alertas.length == 0) {
                alertas.push(" Atividade dentro dos padrões esperados até o momento.");
            }


            const conteudo = `
        <h2>Relatório de Alertas - Logs do Sistema</h2>
        <p><b>Total de Eventos:</b> ${totalEventos}</p>
        <p><b>Usuários Ativos:</b> ${usuariosAtivos}</p>
        <p><b>Máquinas Alteradas:</b> ${maquinasAlteradas}</p>
        <p><b>Falhas em Ações:</b> ${falhas}</p>
        <hr>
        <h3>Alertas e Insights:</h3>
        <ul>
            ${alertas.map(a => `<li>${a}</li>`).join("")}
        </ul>
    `;


            var janela = window.open("", "", "width=800,height=600");
            janela.document.write(conteudo);
            janela.document.close();
        }


        document.querySelectorAll(".cartao-downloads p")[0].onclick = gerarRelatorioDeAlertas;
        document.querySelectorAll(".cartao-downloads p")[1].onclick = exportarExcel;



    </script>
