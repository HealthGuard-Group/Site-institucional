<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthGuard - Análise de Disco</title>
    <link rel="shortcut icon" type="imagex/png" href="../assets/icon/healthguard_icone.png">
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/menu_bar.css">
    <link rel="stylesheet" href="../css/analiseDisco.css">
    <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
</head>

<body onload="validarSessao()">
    <!-- Começo do Menu -->
    <div class="menu-lateral">
        <div class="pai-icones-superiores">
            <div id="logo">
                <img src="../assets/imgs/HealthGuard_icone_BRANCO_fundo_transparente.png" alt="HealthGuard"
                    class="icone-logo-pequena">
            </div>
            <br>
            <div class="icone-box" id="monitoramento_redirecionamento">
                <img src="../assets/imgs/icone_monitoramento.png" alt="Foto" class="icone-menu-1">
                <div class="texto-icone oculto">Monitoramento</div>
            </div>
            <hr class="separador">
            <div class="icone-box" id="gestao_redirecionamento">
                <img src="../assets/imgs/icone_gestao_usuarios.png" alt="Foto" class="icone-menu-2">
                <div class="texto-icone oculto">Gestão de funcionários</div>
            </div>
            <hr class="separador">
            <div class="icone-box" id="alertas_redirecionamento">
                <img src="../assets/imgs/icone_alerta.png" alt="Foto" class="icone-menu-3">
                <div class="texto-icone oculto">Histórico de Alertas</div>
            </div>
            <hr class="separador">
            <div class="icone-box" id="gestao_convites">
                <img src="../assets/imgs/icone-convite2.png" alt="Foto" class="icone-menu-2">
                <div class="texto-icone oculto">Convites</div>
            </div>
            <hr class="separador">
            <div class="icone-box" id="suporte_redirecionamento">
                <img src="../assets/imgs/icone_suporte.png" alt="Foto" class="icone-menu-4">
                <div class="texto-icone oculto">Suporte</div>
            </div>
        </div>
        <div class="pai-icones-inferiores">
            <hr class="separador-forte">
            <div class="icone-box-inferior" id="tela_perfil">
                <img src="../assets/imgs/icone_perfil.png" alt="Foto" class="icone-menu-5">
                <div class="texto-icone oculto" id="nome_usuario">Perfil</div>
            </div>
            <hr class="separador">
            <div class="icone-box-inferior" id="sair_conta_redirecionamento">
                <img src="../assets/imgs/icone_log-out.png" alt="Foto" class="icone-menu-6">
                <div class="texto-icone oculto">Sair da conta</div>
            </div>
        </div>
    </div>
    <!-- Fim do Menu -->

    <div class="container">
        <div class="conteudo-principal">
            <div class="header">
                <div class="header-esquerda">
                    <img src="../assets/imgs/seta-esquerda.png" id="bt-voltar">
                    <span id="nome_MaquinaDac">Monitoramento</span>
                    <img src="../assets/imgs/botao_seta_preto.png" alt="">
                    <span id="nome_MaquinaDac">Máquina A-01</span>
                    <img src="../assets/imgs/botao_seta_preto.png" alt="">
                    <span id="nome_MaquinaDac">Análise de Disco</span>

                    <!-- <span class="status alerta" id="status_MaquinaDac"></span> -->
                </div>
            </div>

            <div class="corpo">
                <div class="box-kpis">
                    <div class="kpi kpi-1">
                        <div class="top">
                            <div class="titulo-kpi">
                                <b>Percentual de uso do disco</b>
                            </div>
                            <div class="icone-info">
                                <span class="tooltip">
                                    <i class='bxr  bx-info-circle'></i>
                                    <span class="tooltip-text">
                                        Valor em porcentagem correspondente à quantidade de disco utilizada de acordo
                                        com a capacidade total
                                    </span>
                                </span>
                            </div>
                        </div>
                        <div class="dado-kpi">
                            <b>78%</b>
                        </div>
                    </div>
                    <div class="kpi kpi-2">
                        <div class="top">
                            <div class="titulo-kpi">
                                <b>Espaço disponível</b>
                            </div>
                            <div class="icone-info">
                                <span class="tooltip">
                                    <i class='bxr  bx-info-circle'></i>
                                    <span class="tooltip-text">
                                        Quantidade de Gigabytes disponíveis do disco
                                    </span>
                                </span>
                            </div>
                        </div>
                        <div class="dado-kpi">
                            <b>120 GB</b>
                        </div>
                    </div>
                    <div class="kpi kpi-3">
                        <div class="top iops-top">
                            <div class="titulo-kpi iops-titulo">
                                <b>Número de operações de leitura e escrita por segundo</b>
                            </div>
                            <div class="icone-info iops-icone-info">
                                <span class="tooltip">
                                    <i class='bxr  bx-info-circle'></i>
                                    <span class="tooltip-text">
                                        IOPS: "Operações de Entrada/Saída por Segundo". Métrica que mede o desempenho do
                                        disco. Quanto maior o número de IOPS, mais rápida é a unidade.
                                    </span>
                                </span>
                            </div>
                        </div>
                        <div class="dado-kpi">
                            <b>1.2 K/s</b>
                        </div>
                    </div>
                    <div class="kpi kpi-4">
                        <div class="top">
                            <div class="titulo-kpi">
                                <b>Capacidade total</b>
                            </div>
                            <div class="icone-info">
                                <span class="tooltip">
                                    <i class='bxr  bx-info-circle'></i>
                                    <span class="tooltip-text tooltip-perto-da-borda">
                                        Capacidade total de armazenamento do disco em Gibabytes
                                    </span>
                                </span>
                            </div>
                        </div>
                        <div class="dado-kpi">
                            <b>512 GB</b>
                        </div>
                    </div>
                </div>

                <div class="container-graficos">

                    <div class="box-graficos-duplo">
                        <div class="grafico-esquerda">
                            <div class="top-grafico">
                                <div class="titulo-grafico">
                                    <b>Uso do disco (Espaço usado x Espaço disponível)</b>
                                </div>
                                <div class="icone-info-grafico icone-info-grafico-donut">
                                    <span class="tooltip">
                                        <i class='bxr  bx-info-circle'></i>
                                        <span class="tooltip-text tooltip-perto-da-borda">
                                            Percentual de uso do disco em relação ao percentual de espaço disponível do
                                            disco
                                        </span>
                                    </span>
                                </div>
                            </div>
                            <div class="dado-grafico">
                                <!-- Gráfico de pizza -->
                                <canvas id="myChart1-pizza"></canvas>
                            </div>
                        </div>
                        <div class="grafico-direita">
                            <div class="top-grafico">
                                <div class="titulo-grafico titulo-grafico-barras">
                                    <b>Distribuição do uso por partição</b>
                                </div>
                                <div class="icone-info-grafico icone-grafico-barras">
                                    <span class="tooltip">
                                        <i class='bxr  bx-info-circle'></i>
                                        <span class="tooltip-text tooltip-perto-da-borda">
                                            Percentual de disco que está sendo utilizado em cada partição do disco
                                        </span>
                                    </span>
                                </div>
                            </div>
                            <div class="dado-grafico">
                                <!-- Gráfico de Barras -->
                                <canvas id="myChart2-barra"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="box-grafico-unico-comprido">
                        <div class="top-grafico top-grafico-linha">
                            <div class="titulo-grafico titulo-grafico-linha">
                                <b>Últimas variações e tendência do uso do disco</b>
                            </div>
                            <div class="icone-info-grafico icone-grafico-linha">
                                <span class="tooltip">
                                    <i class='bxr  bx-info-circle'></i>
                                    <span class="tooltip-text tooltip-perto-da-borda">
                                        Últimas 10 variações no percentual de uso do disco e tendência de uso baseado no conceito de regressão linear simples, com a finalidade de prever de forma aproximada as próximas variações
                                    </span>
                                </span>
                            </div>
                        </div>
                        <div class="dado-grafico dado-grafico-linha">
                            <!-- Gráfico de Linha -->
                            <canvas id="myChart-linha"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
<script src="../js/validarSessao.js"></script>
<script src="../js/menu-lateral.js"></script>

<style>
    #myChart1-pizza {
        justify-content: start;
        max-width: 90%;
        max-height: 105%;
        margin-top: -1%;
    }
</style>

<script>

    const ctx = document.getElementById('myChart1-pizza').getContext('2d');

    const data = {
        labels: ['Espaço usado', 'Espaço disponível'],
        datasets: [{
            data: [78, 30],
            backgroundColor: [
                'rgba(27, 53, 89, 1)',
                '#05cd49',
            ],
            borderWidth: 1
        }]
    };

    const options = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'right', // legenda ao lado
                labels: {
                    // font: {
                    //     size: 14
                    // },
                    color: '#333'
                }
            },
        },
        layout: {
            padding: 20
        },
        // datalabels: {
        //     color: '#fff',
        //     font: {
        //         weight: 'bold',
        //         size: 26
        //     },
        //     formatter: function (value, context) {
        //         return value + "%"
        //     }
        // },
        // plugins: [ChartDataLabels]
    };

    new Chart(ctx, {
        type: 'doughnut',
        data: data,
        options: options
    });
</script>

<style>
    #myChart2-barra {
        max-width: 95%;
        max-height: 95%;
        margin-top: -1%;
    }
</style>

<script>
    const ctx2 = document.getElementById('myChart2-barra').getContext('2d');

    const dataBarra = {
        labels: ['C:/', 'D:/', 'E:/'],
        datasets: [{
            label: 'Percentual usado',
            data: [25, 30, 20],
            backgroundColor: [
                'rgba(27, 53, 89, 1)',
            ],
            borderWidth: 1,
            borderRadius: 6
        }]
    };

    const optionsBarra = {
        indexAxis: 'y', // transforma em barras horizontais
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            // legend: {
            //     position: 'top',
            //     labels: {
            //         font: {
            //             size: 14
            //         },
            //         color: '#333'
            //     }
            // },
        },
        scales: {
            x: {
                beginAtZero: true,
                ticks: {
                    font: {
                        size: 12
                    }
                }
            },
            y: {
                ticks: {
                    font: {
                        size: 12
                    }
                }
            }
        }
    };

    new Chart(ctx2, {
        type: 'bar',
        data: dataBarra,
        options: optionsBarra
    });
</script>

<style>
    #myChart-linha {
        max-width: 98%;
        max-height: 100%;
        width: 100%;
        /* height: 100%; */
        margin-top: 2%;
    }
</style>

<script>
    const ctxLinha = document.getElementById('myChart-linha').getContext('2d');

    // Dados reais
    const labels = [
        ['15/10/2025', '10:05:20'],
        ['15/10/2025', '10:10:20'],
        ['15/10/2025', '10:15:20'],
        ['15/10/2025', '10:20:20'],
        ['15/10/2025', '10:25:20'],
        ['15/10/2025', '10:05:20'],
        ['15/10/2025', '10:10:20'],
        ['15/10/2025', '10:15:20'],
        ['15/10/2025', '10:20:20'],
        ['15/10/2025', '10:25:20'],
    ];
    const y = [20.5, 20, 21, 22, 20, 21, 20.3, 22, 21, 23];

    // Transformar datas em índices simples
    const x = y.map((_, i) => i);

    // Função simples de regressão
    function regressaoLinear(x, y) {
        const n = x.length;
        const somaX = x.reduce((a, b) => a + b, 0);
        const somaY = y.reduce((a, b) => a + b, 0);
        const somaXY = x.reduce((s, xi, i) => s + xi * y[i], 0);
        const somaX2 = x.reduce((s, xi) => s + xi * xi, 0);

        const a = (n * somaXY - somaX * somaY) / (n * somaX2 - somaX * somaX);
        const b = (somaY - a * somaX) / n;
        return { a, b };
    }

    // Calcular a e b
    const { a, b } = regressaoLinear(x, y);

    // Criar linha de tendência
    const yPrevisto = x.map(xi => a * xi + b);

    // Estimar quando chegará a 100%
    const xColapso = (100 - b) / a;
    const dataColapsoTexto = "≈ ponto " + xColapso.toFixed(1);

    const ultimaData = new Date("2025-10-15 10:25:20");
    const minutosEntrePontos = 5;

    const minutosAteColapso = xColapso * minutosEntrePontos;

    const dataColapsoReal = new Date(ultimaData.getTime() + minutosAteColapso * 60000);

    // Gráfico
    new Chart(ctxLinha, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Percentual usado (real)',
                    data: y,
                    borderColor: 'rgba(27, 53, 89, 1)',
                    backgroundColor: 'rgba(27, 53, 89, 1)',
                    tension: 0.3,
                    // fill: false,
                    order: 1
                },
                {
                    label: 'Tendência (regressão linear)',
                    data: yPrevisto,
                    borderColor: 'rgb(255, 0, 0)',
                    backgroundColor: 'rgba(255, 0, 0, 0.3)',
                    borderDash: [10, 6],
                    tension: 0,
                    // fill: true,
                    order: 99
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                annotation: {
                    annotations: {
                        colapso: {
                            type: 'line',
                            borderColor: 'red',
                            borderWidth: 2,
                            scaleID: 'y',
                            value: 100
                        }
                    }
                },
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Horário da Medição'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Percentual de Uso (%)'
                    },
                    // min: 0,     // mínimo
                    // max: 100,   // máximo
                    // ticks: {
                    //     stepSize: 1 // opcional: espaçamento dos números
                    // }
                }
            }
        }
    });
</script>


</html>