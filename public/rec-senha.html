<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="imagex/png" href="./assets/icon/healthguard_icone.png">
    <link rel="stylesheet" href="./css/recuperacao-senha.css">
    <link rel="stylesheet" href="./css/global.css">
    <title>Esqueci minha senha</title>
</head>

<body>
    <button onclick="history.back()" class="btn-voltar">
        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="13 16 9 12 13 8"></polyline>
        </svg>
    </button>
    <div class="right">
        <img src="./assets/imgs/HealthGuard_Logomarca_BRANCA_fundo_transparente.png" alt="HealthGuard Logo">
        <h1>Esqueceu sua senha</h1>
        <p>Recupere seu acesso e volte a monitorar tudo com <br>
            tranquilidade e segurança.</p>
    </div>
    <div class="left">
        <div class="container">
            <div id="tela_email">
                <h2>Esqueceu a senha?</h2>
                <p>Insira o e-mail no qual deseja redefinir a sua senha </p>

                <label for="email">E-mail</label>
                <input id="email_input" type="text" placeholder="exemplo: healthguard@sptech.school">
                <button onclick="validar_redefinir()">Redefinir senha</button>
                <br>
                <div id="mensagem"></div>
            </div>
            <div id="tela_codigo" class="oculto">
                <h2>Confirmação de conta</h2>
                <p>Enviamos um código para seu email, para a recuperação da sua senha:</p>

                <label for="email">Código de recuperação:</label>
                <div class="input-separada">
                    <input type="text" maxlength="1" class="input-caractere" style="width: 14%;" id="input1">
                    <input type="text" maxlength="1" class="input-caractere" style="width: 14%;" id="input2">
                    <input type="text" maxlength="1" class="input-caractere" style="width: 14%;" id="input3">
                    <input type="text" maxlength="1" class="input-caractere" style="width: 14%;" id="input4">
                    <input type="text" maxlength="1" class="input-caractere" style="width: 14%;" id="input5">
                    <input type="text" maxlength="1" class="input-caractere" style="width: 14%;" id="input6">
                </div>
                <div id="mensagem_erro"></div>
                <p>Reenviar o email</p>
                <button onclick="validarUsuario()">Redefinir senha</button>
                <br>
                <div id="mensagem"></div>
            </div>
            <div id="tela_senha" class="oculto">
                <h2>Crie uma nova senha</h2>
                <p>Por favor, insira e confirme sua nova senha abaixo.</p>

                <label for="senha">Sua senha nova:</label>
                <input id="senha_input" type="password" placeholder="Digite sua nova senha" oninput="validarSenha()">
                <div id="mensagem_erro_senha"></div>
                <label for="confirma_senha">Confirme sua senha nova:</label>
                <input id="confirma_senha_input" type="password" placeholder="Digite novamente sua nova senha"
                    oninput="validarConfirmarSenha()">
                <div id="mensagem_erro_confirmar_senha"></div>
                <button onclick="trocarSenha()">Redefinir senha</button>
                <br>
                <div id="mensagem"></div>
            </div>
        </div>
    </div>

</body>

</html>
<script>
    // Funcionamento da input separada
    var inputs_caracteres = document.querySelectorAll(".input-caractere")
    inputs_caracteres.forEach((input, index) => {

        input.addEventListener('input', () => {
            input.value = input.value.replace(/\s/g, '')
        })

        input.addEventListener('keyup', (e) => {
            var valor_input = input.value;
            if (valor_input.length == 1 && e.key !== 'Backspace') {
                if (index < inputs_caracteres.length - 1) {
                    inputs_caracteres[index + 1].focus()
                }
            }
        })
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace') {
                if (input.value.length == 0) {
                    if (index > 0) {
                        inputs_caracteres[index - 1].focus()
                    }
                }
            }
        })
    })
    function voltar() {
        window.location.href = "./login.html"
    }
    // Validações senha
    function validarSenha() {
        var senha = document.getElementById("senha_input")
        if (senha.value.length > 8) {
            senha.style.border = '0.2vh solid #0AA40A'
            senha.style.boxShadow = '#0aa40a38 0px 2px 8px 0px'
        } else {
            senha.style.border = '0.2vh solid #D30808'
            senha.style.boxShadow = '#d308082d 0px 2px 8px 0px'
        }
    }
    function validarConfirmarSenha() {
        var senha = document.getElementById("senha_input")
        var senha_confirmar = document.getElementById("confirma_senha_input")
        if (senha.value == senha_confirmar.value) {
            senha_confirmar.style.border = '0.2vh solid #0AA40A'
            senha_confirmar.style.boxShadow = '#0aa40a38 0px 2px 8px 0px'
        } else {
            senha_confirmar.style.border = '0.2vh solid #D30808'
            senha_confirmar.style.boxShadow = '#d308082d 0px 2px 8px 0px'
        }
    }
    function trocarSenha() {
        var senha = document.getElementById("senha_input")
        var senha_confirmar = document.getElementById("confirma_senha_input")
        var aux_erro = false
        if (senha.value.length < 9) {
            mensagem_erro_senha.innerHTML = `<span style="color:red">A senha precisa conter no mínimo 9 caracteres</span>`
            aux_erro = true
        } else {
            mensagem_erro_senha.innerHTML = ``
        } if (senha_confirmar.value != senha.value) {
            mensagem_erro_confirmar_senha.innerHTML = `<span style="color:red">As senhas são diferentes</span>`
            aux_erro = true
        } else {
            mensagem_erro_confirmar_senha.innerHTML = ``
        } if (aux_erro) {
            return
        }
    }
    function validar_redefinir() {
        mensagem.innerHTML = ""
        var email = email_input.value;
        if (email == "") {
            mensagem.innerHTML = "Preencha o campo e-mail..."
            return;
        }
        var posArroba = email.indexOf('@');
        if (posArroba <= 0) {
            mensagem.innerHTML = "Insira um e-mail válido!";
            return;
        }
        var posPonto = email.indexOf('.', posArroba);
        if (posPonto <= 0 || posPonto === email.length - 1) {
            mensagem.innerHTML = "Insira um e-mail válido!";
            return;
        }


        // mensagem.innerHTML = "Verificando email.";
        // setTimeout(function () {
        //     mensagem.innerHTML = "Verificando email..";
        // }, 300);
        // setTimeout(function () {
        //     mensagem.innerHTML = "Verificando email...";
        // }, 600);
        // setTimeout(function () {
        //     mensagem.innerHTML = "";
        // }, 1000);

        // função abaixo não existe, só é uma representação de como continuar o desenvolvimento
        confirmarUsuario();
    }
    function confirmarUsuario() {
        document.getElementById("tela_email").classList.add("oculto")
        document.getElementById("tela_codigo").classList.remove("oculto")
    }
    function validarUsuario() {
        var input1 = document.getElementById("input1").value
        var input2 = document.getElementById("input2").value
        var input3 = document.getElementById("input3").value
        var input4 = document.getElementById("input4").value
        var input5 = document.getElementById("input5").value
        var input6 = document.getElementById("input6").value
        var codigo = input1 + input2 + input3 + input4 + input5 + input6
        if (codigo.length != 6) {
            mensagem_erro.innerHTML = `<span style="color:red">Código inválido</span>`
            return
        } else {
            mensagem_erro.innerHTML = ``
        }
        document.getElementById("tela_codigo").classList.add("oculto")
        document.getElementById("tela_senha").classList.remove("oculto")
    }

</script>